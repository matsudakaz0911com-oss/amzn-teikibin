<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¿ãƒ–ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚¿ã‚¤ãƒˆãƒ« -->
    <title>ğŸ“¦ã‚¢ãƒã‚¾ãƒ³å®šæœŸä¾¿ç™ºæ³¨ã‚¢ã‚¤ãƒ†ãƒ ç¢ºèª</title>
    
    <!-- --- iPhoneç”¨ã‚¢ã‚¤ã‚³ãƒ³ãƒ»ã‚¢ãƒ—ãƒªè¨­å®š --- -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã—ãŸæ™‚ã®ã‚¢ã‚¤ã‚³ãƒ³ä¸‹ã®åå‰ -->
    <meta name="apple-mobile-web-app-title" content="ã‚¢ãƒã‚¾ãƒ³å®šæœŸä¾¿">
    <link rel="apple-touch-icon" href="https://api.dicebear.com/7.x/notionists/svg?seed=box&backgroundColor=f97316">
    <!-- ---------------------------------- -->

    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot, updateDoc, collection, getDoc, setDoc, writeBatch, query, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // --- ã€é‡è¦ã€‘Firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰å–å¾—ã—ãŸè¨­å®šã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ ---
        const firebaseConfig = {
            apiKey: "AIzaSyA-QUozEP_7J6YpvyW2CnDsMrF69AI7TIY",
            projectId: "amzn-teikibin",
            appId: "1:653957134124:web:bb9431801a645bac061e89",
        };
        // -----------------------------------------------------------------------

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const itemsRef = collection(db, "stock_list");

        const masterList = [
            { n: "ã‚­ãƒƒãƒãƒ³æ³¡ãƒã‚¤ã‚¿ãƒ¼ è©°æ›¿ 1L", isSub: true }, { n: "ãƒ•ã‚£ãƒ‹ãƒƒã‚·ãƒ¥ é£Ÿæ´—æ©Ÿæ´—å‰¤3è¢‹", isSub: true },
            { n: "ã‚­ãƒ¥ã‚­ãƒ¥ãƒƒãƒˆ æ³¡ã‚¹ãƒ—ãƒ¬ãƒ¼ è©°æ›¿", isSub: true }, { n: "CLEAR ã‚¹ã‚«ãƒ«ãƒ—ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼ è©°æ›¿", isSub: true },
            { n: "ãƒ“ã‚ªãƒ¬u æ³¡ãƒãƒ³ãƒ‰ã‚½ãƒ¼ãƒ—", isSub: true }, { n: "ãƒ€ãƒ´ãƒ¡ãƒ³ æ³¡æ´—é¡”", isSub: true },
            { n: "LUX ãƒˆãƒªãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆ è©°æ›¿", isSub: true }, { n: "LUX ã‚·ãƒ£ãƒ³ãƒ—ãƒ¼ è©°æ›¿", isSub: true },
            { n: "æŸ¿æ¸‹ãƒœãƒ‡ã‚£ã‚½ãƒ¼ãƒ— 1400ml", isSub: true }, { n: "ãƒ¡ãƒ³ã‚ºãƒ“ã‚ªãƒ¬ æ³¡æ´—é¡”", isSub: true },
            { n: "ã•ã‚‰ã• æ´—æ¿¯æ´—å‰¤ 1900g", isSub: true }, { n: "ã‚¨ãƒãƒ¼ãƒ«ãŠã—ã‚ƒã‚Œç€æ´—å‰¤ è©°æ›¿", isSub: true },
            { n: "ã•ã‚‰ã• æŸ”è»Ÿå‰¤ è©°æ›¿Ã—2è¢‹", isSub: true }, { n: "ã‚«ãƒ“ã‚­ãƒ©ãƒ¼ æ´—æ¿¯æ§½ã‚¯ãƒªãƒ¼ãƒŠãƒ¼Ã—3", isSub: true },
            { n: "ãƒ¯ã‚¤ãƒ‰ãƒã‚¤ã‚¿ãƒ¼ EXãƒ‘ãƒ¯ãƒ¼ 2400ml", isSub: true }, { n: "ãƒˆã‚¤ãƒ¬ã‚¯ã‚¤ãƒƒã‚¯ãƒ« è©°æ›¿ 6å€‹", isSub: true },
            { n: "ã‚¹ã‚¯ãƒ©ãƒ“ãƒ³ã‚°ãƒãƒ–ãƒ«ã€€ãƒˆã‚¤ãƒ¬ãƒ–ãƒ©ã‚·", isSub: true }, { n: "ã‚ªãƒ¼ãƒ«ãƒ•ãƒªãƒ¼ 24æœ¬", isSub: false },
            { n: "UCC ã‚´ãƒ¼ãƒ«ãƒ‰ã‚¹ãƒšã‚·ãƒ£ãƒ« ç²‰", isSub: false }, { n: "ã‚¸ãƒ§ãƒ¼ã‚¸ã‚¢ ãƒ–ãƒ©ãƒƒã‚¯ 950mlÃ—12", isSub: false },
            { n: "ã‚­ãƒªãƒ³ å¤©ç„¶æ°´ 2LÃ—9æœ¬", isSub: false }, { n: "ã‚¢ã‚¤ãƒªã‚¹ å¤©ç„¶æ°´ 500mlÃ—24æœ¬", isSub: false },
            { n: "ã‚¢ã‚¤ãƒªã‚¹ å¼·ç‚­é…¸æ°´ 500mlÃ—24æœ¬", isSub: false }, { n: "ãƒãƒ«ã‚µãƒ³ è±†ä¹³ ä½ç³– 1LÃ—6æœ¬", isSub: false },
            { n: "ã‚­ãƒªãƒ³ ãƒ¯ãƒ³ãƒ‡ã‚¤ ãƒ–ãƒ©ãƒƒã‚¯ 24æœ¬", isSub: false }, { n: "ã‚®ãƒ¼ã‚¤ãƒ¼ã‚¸ãƒ¼ ã‚®ãƒ¼ 200g", isSub: false },
            { n: "é¶ãŒã‚‰ã‚¹ãƒ¼ãƒ— 500g", isSub: false }, { n: "ã‚¹ãƒ‘ã‚²ãƒƒãƒ†ã‚£ 5kg", isSub: false },
            { n: "ãƒã‚¦ã‚¹ ãƒ—ãƒ©ã‚¤ãƒ ã‚«ãƒ¬ãƒ¼ 4ç¨®ã‚»ãƒƒãƒˆ", isSub: false }, { n: "ã‚·ãƒ¼ãƒã‚­ãƒ³ ãƒã‚¤ãƒ«ãƒ‰ 12ç¼¶", isSub: false },
            { n: "ãƒ–ãƒ©ãƒƒã‚¯ãƒšãƒƒãƒ‘ãƒ¼ ãƒ›ãƒ¼ãƒ« 380g", isSub: false }, { n: "ã‚±ãƒ³ãƒŸãƒ³ å³å¸­ç„¼ãƒ“ãƒ¼ãƒ•ãƒ³ 10å€‹", isSub: false },
            { n: "æ°¸è°·åœ’ ã‚ã‹ã‚ã‚¹ãƒ¼ãƒ— 100è¢‹", isSub: false }, { n: "ãã‚‰ã“ã‚“ å¡©ã“ã‚“ã¶ 500g", isSub: false },
            { n: "ã‚¶ãƒã‚¹ ãƒŸãƒ«ã‚¯ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³ 24æœ¬", isSub: false }, { n: "ã‚¶ãƒã‚¹ ãƒªãƒƒãƒã‚·ãƒ§ã‚³ãƒ© 1kg", isSub: false },
            { n: "REYS EAA 600g", isSub: false }, { n: "REYS ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³ ãƒãƒ§ã‚³ 1kg", isSub: false },
            { n: "REYS ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³ ãƒ¨ãƒ¼ã‚°ãƒ«ãƒˆ", isSub: false }, { n: "ã‚¯ãƒƒã‚­ãƒ³ã‚°ã‚·ãƒ¼ãƒˆ(2æœ¬)", isSub: false },
            { n: "ãƒãƒ”ã‚¢ ãƒã‚±ãƒƒãƒˆãƒ†ã‚£ã‚·ãƒ¥", isSub: true }, { n: "ãƒ“ã‚ªã‚¹ãƒªãƒ¼HiéŒ  570éŒ ", isSub: false },
            { n: "ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒã‚¹ã‚¯ å°ã•ã‚ 200æš", isSub: true }, { n: "å˜3é›»æ±  48æœ¬", isSub: true }
        ];

        async function checkAndShiftMonth() {
            const now = new Date();
            const monthTag = `${now.getFullYear()}-${now.getMonth() + 1}`;
            const sysRef = doc(db, "system", "config");
            const sysSnap = await getDoc(sysRef);
            const querySnap = await getDocs(itemsRef);
            const batch = writeBatch(db);

            let needsReset = !sysSnap.exists() || sysSnap.data().lastCheck !== monthTag;

            if (querySnap.empty) {
                masterList.forEach((item, i) => {
                    const id = `item_${String(i + 1).padStart(2, '0')}`;
                    batch.set(doc(db, "stock_list", id), { name: item.n, status: 0, note: "", order: i, isSub: item.isSub });
                });
            } else {
                querySnap.forEach((d) => {
                    const data = d.data();
                    const masterInfo = masterList[data.order];
                    const updateData = {};
                    if (masterInfo) updateData.isSub = masterInfo.isSub;
                    if (needsReset) {
                        const currentStatus = data.status || 0;
                        updateData.status = currentStatus > 0 ? currentStatus - 1 : 0;
                    }
                    if (Object.keys(updateData).length > 0) batch.update(d.ref, updateData);
                });
            }
            batch.set(sysRef, { lastCheck: monthTag }, { merge: true });
            await batch.commit();
        }

        function render(items) {
            const listEl = document.getElementById('list');
            listEl.innerHTML = '';
            items.forEach(item => {
                const isNow = item.status == 0;
                const card = document.createElement('div');
                const subBorder = item.isSub ? 'border-l-[10px] border-l-blue-400' : 'border-l-2';
                const nowBg = isNow ? 'bg-orange-50 border-orange-400 ring-2 ring-orange-100' : 'bg-white border-gray-100 opacity-70';
                
                card.className = `p-4 mb-4 rounded-2xl border-2 transition-all ${subBorder} ${nowBg}`;
                card.innerHTML = `
                    <div class="flex justify-between items-center mb-3 pl-1">
                        <span class="font-black ${isNow ? 'text-gray-900 text-lg' : 'text-gray-400 text-base'}">${item.name}</span>
                        ${isNow ? '<span class="text-[10px] bg-orange-600 text-white px-2 py-1 rounded-md font-bold shadow-sm">ä»Šå›ç™ºæ³¨</span>' : ''}
                    </div>
                    <div class="grid grid-cols-4 gap-2 mb-3">
                        ${['ä»Šå›', 'ç¿Œæœˆã¸', '2æœˆå¾Œ', '3æœˆå¾Œ'].map((label, i) => `
                            <button onclick="updateStatus('${item.id}', ${i})" class="py-2 text-[10px] font-bold rounded-lg border transition-all ${item.status == i ? 'bg-orange-600 text-white border-orange-700 shadow-inner' : 'bg-white text-gray-400 border-gray-100'}">${label}</button>
                        `).join('')}
                    </div>
                    <input type="text" placeholder="ãƒ¡ãƒ¢" value="${item.note || ''}" onchange="updateNote('${item.id}', this.value)"
                        class="w-full text-xs p-3 rounded-xl bg-white border border-gray-200 outline-none focus:ring-2 focus:ring-orange-300">
                `;
                listEl.appendChild(card);
            });
        }

        window.updateStatus = (id, s) => updateDoc(doc(db, "stock_list", id), { status: s });
        window.updateNote = (id, n) => updateDoc(doc(db, "stock_list", id), { note: n });

        window.onload = async () => {
            await checkAndShiftMonth();
            onSnapshot(query(itemsRef, orderBy("order")), (snap) => {
                const data = [];
                snap.forEach(d => data.push({ id: d.id, ...d.data() }));
                render(data);
            });
        };
    </script>
    <style>
        body { -webkit-tap-highlight-color: transparent; background-color: #f8fafc; font-family: sans-serif; }
        .sticky-header { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); }
        body { padding-top: env(safe-area-inset-top); }
    </style>
</head>
<body>
    <header class="sticky-header sticky top-0 z-50 p-4 border-b flex flex-col items-center shadow-sm">
        <h1 class="font-black text-orange-600 tracking-tighter text-sm mb-1">ğŸ“¦ã‚¢ãƒã‚¾ãƒ³å®šæœŸä¾¿ç™ºæ³¨ã‚¢ã‚¤ãƒ†ãƒ ç¢ºèª</h1>
        <div class="flex items-center gap-2">
            <div class="w-2 h-3 bg-blue-400 rounded-sm shadow-sm"></div>
            <span class="text-[9px] font-bold text-blue-600">é’ï¼šæ´—å‰¤ãƒ»æ—¥ç”¨å“ç³»</span>
        </div>
    </header>
    <main id="list" class="p-4 max-w-md mx-auto pb-20"></main>
</body>
</html>
